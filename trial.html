<!DOCTYPE html>
<html>
  <head>
    <style>
      #dropBox {
        width: 300px;
        height: 300px;
        border: 2px dashed #ccc;
        text-align: center;
        padding: 10px;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }
      
      #dropBox img {
        max-width: 100%;
        max-height: 100%;
        position: absolute;
        left: 0;
        top: 0;
        pointer-events: auto;
        cursor: move;
        transition: transform 0.3s ease;
      }
    </style>
  </head>
  <body>
    <div id="dropBox" onclick="promptForImage()" style="pointer-events: auto;">
      <p>Click here or drag and drop an image file</p>
    </div>

    <script>
      var dragStartX;
      var dragStartY;
      var dragOffsetX;
      var dragOffsetY;
      var isDragging = false;

      function promptForImage() {
        if (isDragging) {
          return;
        }

        var imageUrl = prompt("Please provide the image URL:");
        if (imageUrl !== null && imageUrl.trim() !== "") {
          var img = new Image();
          img.onload = function() {
            displayImage(img);
          };
          img.onerror = function() {
            alert("Failed to load image from URL.");
          };
          img.src = imageUrl;
        } else {
          var fileInput = document.createElement("input");
          fileInput.type = "file";
          fileInput.accept = "image/*";
          fileInput.addEventListener("change", handleFileSelection);
          fileInput.click();
        }
      }

      function handleDrop(e) {
        e.preventDefault();
        var file = e.dataTransfer.files[0];
        if (file.type.match("image.*")) {
          readAndDisplayImage(file);
        } else {
          alert("Please drop an image file.");
        }
      }

      function handleDragOver(e) {
        e.preventDefault();
      }

      var dropBox = document.getElementById("dropBox");
      dropBox.addEventListener("drop", handleDrop, false);
      dropBox.addEventListener("dragover", handleDragOver, false);

      function handleFileSelection(e) {
        var fileInput = e.target;
        if (fileInput.files.length > 0) {
          var file = fileInput.files[0];
          if (file.type.match("image.*")) {
            readAndDisplayImage(file);
          } else {
            alert("Please select an image file.");
          }
        } else {
          alert("Please select an image file.");
        }
      }

      function readAndDisplayImage(file) {
        var reader = new FileReader();
        reader.onload = function(event) {
          var dropBox = document.getElementById("dropBox");
          dropBox.innerHTML = "";
          var img = new Image();
          img.onload = function() {
            displayImage(img);
          };
          img.src = event.target.result;
        };
        reader.readAsDataURL(file);
      }

      function displayImage(img) {
        var dropBox = document.getElementById("dropBox");
        dropBox.innerHTML = "";
        dropBox.appendChild(img);
        dropBox.removeAttribute('onclick');

        // Add event listeners for dragging the image
        img.addEventListener("mousedown", startDragging);
        img.addEventListener("touchstart", startDragging);
        img.addEventListener("mouseup", stopDragging);
        img.addEventListener("touchend", stopDragging);
        img.addEventListener("mousemove", dragImage);
        img.addEventListener("touchmove", dragImage);
        img.addEventListener("wheel", zoomImage);
        img.addEventListener("touchstart", handleTouchStart, { passive: false });
        img.addEventListener("touchmove", handleTouchMove, { passive: false });
      }

      function startDragging(e) {
        e.preventDefault();
        isDragging = true;

        if (e.type === "mousedown") {
          dragStartX = e.clientX;
          dragStartY = e.clientY;
        } else if (e.type === "touchstart") {
          dragStartX = e.touches[0].clientX;
          dragStartY = e.touches[0].clientY;
        }

        var dropBox = document.getElementById("dropBox");
        var img = dropBox.querySelector("img");
        var imgRect = img.getBoundingClientRect();
        dragOffsetX = dragStartX - imgRect.left;
        dragOffsetY = dragStartY - imgRect.top;
      }

      function stopDragging() {
        isDragging = false;
      }

      function dragImage(e) {
        if (!isDragging) {
          return;
        }

        e.preventDefault();

        var dropBox = document.getElementById("dropBox");
        var img = dropBox.querySelector("img");

        if (e.type === "mousemove") {
          img.style.left = e.clientX - dragOffsetX + "px";
          img.style.top = e.clientY - dragOffsetY + "px";
        } else if (e.type === "touchmove") {
          img.style.left = e.touches[0].clientX - dragOffsetX + "px";
          img.style.top = e.touches[0].clientY - dragOffsetY + "px";
        }
      }

      function zoomImage(e) {
        e.preventDefault();

        var dropBox = document.getElementById("dropBox");
        var img = dropBox.querySelector("img");

        var zoomFactor = 0.1;
        var zoomAmount = e.deltaY > 0 ? zoomFactor : -zoomFactor;
        var currentScale = getComputedStyle(img).transform.split(" ")[3];
        var newScale = parseFloat(currentScale) + zoomAmount;

        img.style.transform = "scale(" + newScale + ")";
      }

      var touchStartDistance = 0;

      function handleTouchStart(e) {
        var touches = e.touches;
        if (touches.length === 2) {
          touchStartDistance = getDistance(touches[0], touches[1]);
        }
      }

      function handleTouchMove(e) {
        var touches = e.touches;
        if (touches.length === 2) {
          var touchMoveDistance = getDistance(touches[0], touches[1]);
          var zoomFactor = 0.01;
          var zoomAmount = touchMoveDistance > touchStartDistance ? zoomFactor : -zoomFactor;

          var dropBox = document.getElementById("dropBox");
          var img = dropBox.querySelector("img");

          var currentScale = getComputedStyle(img).transform.split(" ")[3];
          var newScale = parseFloat(currentScale) + zoomAmount;

          img.style.transform = "scale(" + newScale + ")";

          touchStartDistance = touchMoveDistance;
        }
      }

      function getDistance(touch1, touch2) {
        var dx = touch2.clientX - touch1.clientX;
        var dy = touch2.clientY - touch1.clientY;
        return Math.sqrt(dx * dx + dy * dy);
      }
    </script>
  </body>
</html>
